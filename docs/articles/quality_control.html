<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="intratumormeth">
<title>Quality Control â€¢ intratumormeth</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quality Control">
<meta property="og:description" content="intratumormeth">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">intratumormeth</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/copynumber.html">Copynumber</a>
    <a class="dropdown-item" href="../articles/preprocessing.html">Preprocessing</a>
    <a class="dropdown-item" href="../articles/quality_control.html">Quality Control</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Quality Control</h1>
            
      
      
      <div class="d-none name"><code>quality_control.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">intratumormeth</span><span class="op">)</span>
<span class="co"># paths</span>
<span class="va">outputDir</span> <span class="op">&lt;-</span> <span class="st">"~/sfb824/packagepdgfra_output"</span>
<span class="va">inputDir</span> <span class="op">&lt;-</span> <span class="st">"~/sfb824/packagepdgfra_input"</span>
<span class="va">samplesheet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"~/sfb824/packagepdgfra_input/samplesheet.csv"</span><span class="op">)</span></code></pre></div>
<p>This document shows some quality control steps that should be performed upstream of a microarray data analysis.</p>
<div class="section level2">
<h2 id="detection-p-values">Detection p-values<a class="anchor" aria-label="anchor" href="#detection-p-values"></a>
</h2>
<p>The EPIC microarray employs a set of control probes that can be evaluated to quantify confidence in the obtained methylation levels for each individual probes. These values are called detection p-values.</p>
<p>Samples with a high average detection p-value should be excluded from the study, as well as probes that fail in multiple samples.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># outputDir contains data previously generated by preprocess_methylation_data()</span>
<span class="va">detP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detection_p_analysis.html">detection_p_analysis</a></span><span class="op">(</span><span class="va">outputDir</span>, 
                             pThreshold <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></code></pre></div>
<p>This returns a list object that contains four members:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">detP</span><span class="op">$</span><span class="va">poorSamplePlot</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">detP</span><span class="op">$</span><span class="va">meanDetP</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">mean_detp</span> <span class="op">&gt;</span> <span class="fl">0.01</span><span class="op">)</span></code></pre></div>
<p>These samples have an average detection p-value higher than 0.01 and should therefore be excluded from further analysis.</p>
<p>Next, the number of individual probes failing in a given sample will be investigated. As can be seen in the function output, there are quite a few poor-quality beta values in the dataset. These are distributed across many probes, so that excluding the respective probes for all samples is not an option since this would remove almost 500,000 CpG methylation levels in our case.</p>
<p>A list of probes that fail for one or more samples is returned:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">detP</span><span class="op">$</span><span class="va">failingProbes</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">detP</span><span class="op">$</span><span class="va">failingProbes</span><span class="op">)</span></code></pre></div>
<p>There are almost 500,000 probes with a poor detection p-value in at least one sample. The majority of these probes fails in just one or two samples, but there are some that consistently fail:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">detP</span><span class="op">$</span><span class="va">failingProbesPlot</span></code></pre></div>
<p>For this study, probes that fail in more than three samples will be excluded, as well as samples that have an average detection p-value greater than 0.01. The corresponding sample and probe ids will be stored on the disk in order to later use these filters when loading the methylation beta values.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">probeFilter</span> <span class="op">&lt;-</span> <span class="va">detP</span><span class="op">$</span><span class="va">failingProbes</span><span class="op">$</span><span class="va">probe_id</span><span class="op">[</span><span class="va">detP</span><span class="op">$</span><span class="va">failingProbes</span><span class="op">$</span><span class="va">failed_in_n_samples</span> <span class="op">&gt;</span> <span class="fl">3</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">probeFilter</span><span class="op">)</span>
<span class="va">sampleFilter</span> <span class="op">&lt;-</span> <span class="va">detP</span><span class="op">$</span><span class="va">meanDetP</span><span class="op">[[</span><span class="st">"sample_id"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">detP</span><span class="op">$</span><span class="va">meanDetP</span><span class="op">$</span><span class="va">mean_detp</span> <span class="op">&gt;</span> <span class="fl">0.01</span><span class="op">]</span>

<span class="co"># save these filters for later use:</span>
<span class="co"># saveRDS(probeFilter, file.path(inputDir, "probe_filter.Rdata"))</span>
<span class="co"># saveRDS(sampleFilter, file.path(inputDir, "sample_filter.Rdata"))</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sex-prediction">Sex prediction<a class="anchor" aria-label="anchor" href="#sex-prediction"></a>
</h2>
<p>Comparing the difference in intensities obtained from probes targeting the sex chromosomes reveals clusters of male and female samples. This feature can be used to predict the sex of a respective sample.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predictedSex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_sex.html">predict_sex</a></span><span class="op">(</span><span class="va">outputDir</span>, normalization <span class="op">=</span> <span class="st">"swan"</span>, predictionCutoff <span class="op">=</span> <span class="op">-</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>This list contains three ggplot objects and a tibble for the predicted sex.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predictedSex</span><span class="op">$</span><span class="va">chrX</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predictedSex</span><span class="op">$</span><span class="va">chrY</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predictedSex</span><span class="op">$</span><span class="va">cutoff</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predictedSex</span><span class="op">$</span><span class="va">predicted_sex</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Compare the predicted sex with the actual sex and filter for those cases where the predicted sex does not match the actual sex:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">patientsheet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">inputDir</span>, <span class="st">"patientsheet.csv"</span><span class="op">)</span><span class="op">)</span>
<span class="va">samplesheet</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">patientsheet</span>, by <span class="op">=</span> <span class="st">"patient_id"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">predictedSex</span><span class="op">$</span><span class="va">predicted_sex</span>, by <span class="op">=</span> <span class="st">"sample_id"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">predicted_sex</span> <span class="op">!=</span> <span class="va">sex</span><span class="op">)</span></code></pre></div>
<p>In sample sfb18_1, predicted and actual sex deviate, which can for example indicate poor sample preparation or sample mislabeling.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Fynn Withake.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
